#automation

cd vagrant-ansible-infra

vagrant up


Prerequisites
A Linux workstation (I am using Ubuntu 20.10) with At least 8 GB of RAM and 15 GB of free hard disk space for the virtual machines.
lsb_release -a
Vagrant 2.2.16
wget https://releases.hashicorp.com/vagrant/2.2.16/vagrant_2.2.16_x86_64.deb
sudo apt install ./vagrant_2.2.16_x86_64.deb
VirtualBox 6.1.22 or above
sudo apt install virtualbox
Ansible 2.9.9
sudo apt-add-repository --yes --update ppa:ansible/ansible
sudo apt install ansible
File Structure
The code used to create a Kubernetes Cluster with Vagrant and Ansible is composed of:

.vagrant/: hidden directory for Vagrant tracking. It includes a Vagrant generated Inventory file: vagrant_ansible_inventory that is used by Ansible to match virtual machines and roles.
add_packages: Ansible playbook to install/remove packages using APT in an Ubuntu system.
roles/
common/: installs the needed packages for Kubernetes (delegating in add_packages) and configures the common settings for Kubernetes master and nodes.
k8s/master/: Ansible playbook to configure a Kubernetes master, it uses the common playbook for shared components between the Kubernetes master and the nodes.
k8s/node/: Ansible playbook to configure a Kubernetes node, it uses the common playbook for shared components between the Kubernetes master and the nodes.
k8s.yml: Ansible playbook that uses the Kubernetes ansible roles.
ditwl-k8s-01-join-command: this file is generated by the Kubernetes master and includes a temporary token and the command needed to join Kubernetes nodes to the cluster.
Vagrantfile: contains the definition of the machines (CPU, memory, network and Ansible playbook and properties)

Kubernetes Network Overview

